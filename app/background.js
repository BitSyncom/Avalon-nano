var setting=[],miner,main=function(){miner=new Miner;miner.onNewNano.addListener(function(a){chrome.runtime.sendMessage({info:"NewNano",nanoId:a.nanoId,deviceType:a.nano.deviceType})});miner.onNanoDeleted.addListener(function(a){chrome.runtime.sendMessage({info:"NanoDeleted",nanoId:a})});miner.onNanoConnected.addListener(function(a){chrome.runtime.sendMessage({info:"NanoConnected",nanoId:a.nanoId,success:a.success})});miner.onNanoDetected.addListener(function(a){chrome.runtime.sendMessage({info:"NanoDetected",
nanoId:a.nanoId,version:a.version,success:a.success})});miner.onNewStatus.addListener(function(a){chrome.runtime.sendMessage({info:"NewStatus",nanoId:a.nanoId,stat:a.stat})});miner.onPoolSubscribed.addListener(function(a){chrome.runtime.sendMessage({info:"PoolSubscribed",poolId:a.poolId,success:a.success})});miner.onPoolAuthorized.addListener(function(a){chrome.runtime.sendMessage({info:"PoolAuthorized",poolId:a.poolId,success:a.success})});miner.onHashrate.addListener(function(a){chrome.runtime.sendMessage({info:"Hashrate",
hashrate:a})});for(var a=0;a<setting.length;a++)void 0!==setting[a]&&null!==setting[a]&&miner.setPool({url:setting[a].url,port:setting[a].port,username:setting[a].username,password:setting[a].password},a)};
chrome.app.runtime.onLaunched.addListener(function(){chrome.storage.local.get("pool",function(a){setting=a.pool||[]});chrome.runtime.onMessage.addListener(function(a,b){if(-1<b.url.indexOf("index.html"))switch(a.info){case "Ready":void 0!==setting&&chrome.runtime.sendMessage({info:"PoolInit",setting:setting});main();break;case "NewPool":miner.setPool({url:a.data.url,port:a.data.port,username:a.data.username,password:a.data.password||"1234"},a.data.poolId);setting[a.data.poolId]={url:a.data.url,port:a.data.port,
username:a.data.username,password:a.data.password||"1234",apiKey:a.data.apiKey};chrome.storage.local.set({pool:setting});break;case "DeletePool":miner.deletePool(a.data.poolId),delete setting[a.data.poolId],chrome.storage.local.set({pool:setting})}});chrome.app.window.create("index.html",{innerBounds:{width:1E3,height:700,minWidth:1E3,minHeight:700},id:"Avalon miner"},function(){chrome.app.window.get("Avalon miner").onClosed.addListener(function(){miner.stop()})})});
