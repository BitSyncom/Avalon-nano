var $jscomp={scope:{},global:this,initSymbolIterator:function(){Symbol=$jscomp.global.Symbol||{};Symbol.iterator||(Symbol.iterator="$jscomp$iterator");$jscomp.initSymbolIterator=function(){}},makeIterator:function(a){$jscomp.initSymbolIterator();if(a[Symbol.iterator])return a[Symbol.iterator]();if(!(a instanceof Array)&&"string"!=typeof a)throw Error();var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}},copyProperties:function(a,b){for(var c in b)a[c]=b[c]},inherits:function(a,
b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}},hashrate=[0,0,0,0],enterFlag=!1,poolObj=[],nanoObj=[],paramObj=[],highcharts,renderChart=function(){Highcharts.setOptions({global:{useUTC:!1}});$("#container").highcharts({chart:{type:"spline",animation:Highcharts.svg,marginRight:10},title:{text:"Avalon miner Live Hashrate"},xAxis:{type:"datetime",tickPixelInterval:150},yAxis:{title:{text:"Hash/s"},min:0,plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{formatter:function(){var a=
Highcharts.dateFormat("%Y-%m-%d %H:%M:%S",this.x),a=a+"<table>",b;for(b in this.points)a+='<tr style="color: '+this.points[b].series.color+'"><td><b>'+this.points[b].series.name+"</b>:&nbsp;</td><td>"+numberShorten(this.points[b].y)+"Hs</td></tr>";return a+"</table>"},useHTML:!0,shared:!0},credits:{enabled:!1},legend:{enabled:!0,layout:"vertical",align:"right",verticalAlign:"top",borderWidth:0},exporting:{enabled:!1},series:function(){for(var a=[],b=["5-Secondly","Minutely","Hourly","Pool"],c=["#808080",
"#feae1b","#00cc99","#0066FF"],d=[],e=(new Date).getTime(),f=-899;0>=f;f++)d.push({x:e+1E3*f,y:0});for(f in b)a.push({name:b[f],color:c[f],data:d});return a}()});highcharts=$("#container").highcharts()},getPrice=function(){setInterval(getRemoteData,5E3)},getRemoteData=function(){var a;$.ajax({url:"https://bitcoinwisdom.com/",type:"GET",success:function(b){a=$(b);$("#_huobi").html($("#market_huobibtccny",a).html());$("#_difficulty").html($("#slot_difficulty",a).html());$("#_next").html($("#slot_estimated",
a).html());$("#_hash_rate").html($("#slot_hash_rate",a).html())}});remoteFlag=!0},getPoolHashRate=function(){setInterval(function(){var a=$("#pool_info tr:eq(1)").data("id");if(void 0!==a){var b=$("#pool-address-"+a).html(),c=$("#pool-worker-"+a).html(),a=$("#pool-api-key-"+a).val();0<b.indexOf("btcchina")&&$.ajax({url:"https://pool.btcchina.com/api?api_key="+a,contentType:"application/json; charset=UTF-8",dataType:"json",success:function(a){a=a.user.workers;if(void 0!==a){a=$jscomp.makeIterator(a);
for(var b=a.next();!b.done;b=a.next())b=b.value,b.worker_name===c&&(hashrate[3]=b.hashrate)}}})}},5E3)},numberShorten=function(a){for(var b=$jscomp.makeIterator([{prefix:"E",base:1E18},{prefix:"P",base:1E15},{prefix:"T",base:1E12},{prefix:"G",base:1E9},{prefix:"M",base:1E6},{prefix:"k",base:1E3}]),c=b.next();!c.done;c=b.next())if(c=c.value,a>c.base)return(a/c.base).toFixed(3)+" "+c.prefix;return a+" "},updateHashrate=function(a){var b=a[a.length-1];hashrate[0]=b.hs5s;hashrate[1]=b.hs1m;hashrate[2]=
b.hs1h;for(var c=a.length-1,b=0;b<c;b++)updateDeviceGHs5s(a[b].deviceId,(a[b].hs5s/1E9).toFixed(1)),updateErrorRate(a[b].deviceId,(100*a[b].errorRate).toFixed(2));a=(new Date).getTime();c=highcharts.series;for(b in c)c[b].addPoint([a,hashrate[b]],!0,!0)},nanoList=function(a){nanoObj.push(a);enterFlag?deviceTr(a):($(".detect p img").attr("src","images/loading-m.gif"),setTimeout(function(){detectDevice()},900))},detectFlag=!1,detectDevice=function(){if(!enterFlag&&(1>nanoObj.length&&($(".detect p").html('<img src="images/device.png">'),
detectFlag=!1),!detectFlag&&1<=nanoObj.length)){detectFlag=!0;$(".detect p img").remove();var a='<div style="text-align:center;"><button type="button" data-type="enter" class="btn btn-default"> Enter </button>  ';poolObj.length||(a+='  <button type="button" data-type="setting-pool" class="btn btn-default"> Set Pool </button>');a+="</div>";$(".detect p").append(a);$("p").delegate("button","click",function(){enterFlag=!0;$(this).data("type");switch($(this).data("type")){case "enter":mainPage();break;
case "setting-pool":settingPool()}})}},poolList=function(a){if(void 0!==a||null!==a)for(var b in a)void 0!==a[b]&&null!==a[b]&&poolObj.push(a[b])},globalSetting=function(a){paramObj=void 0!==a.voltSet&&void 0!==a.freqSet?a:{voltSet:6500,freqSet:[100,100,100]}},loadingImg="<img id='loadImg' src='images/loading.gif'/>",guidePage=function(a){var b=$("#main");b.addClass("center-img").append(loadingImg);setTimeout(function(){$("#loadImg").remove();b.removeClass("center-img");var c='<div class="guide">\n\t\t\t<div class="logo">\n\t\t\t\t<img src="images/logo.png"/>\n\t\t\t</div>\n\t\t\t<div class="detect">\n\t\t\t\t<p>\n\t\t\t\t\t<img src="images/loading-m.gif"/>\n\t\t\t\t</p>\n\t\t\t\t<h4>To begin, plug your Avalon devices into the USB port of the computer</h4>\n\t\t\t\t<h5>If your Avalon devices are not recognized, please contact us by <a href="mailto:service@cannan-creative.com" target="_blank">service@cannan-creative.com</a></h5>\n\t\t\t</div>\n\t\t\t<p>'+
chrome.runtime.getManifest().name+" v"+chrome.runtime.getManifest().version+'<br />\n\t\t\tPowered by <a href="http://www.canaan-creative.com" target="_blank">Canaan-Creative</a></p>\n\t\t</div>';b.append(c);setTimeout(function(){$(".detect p img").attr("src","images/device.png");a()},500)},500)},guideCallback=function(){chrome.runtime.sendMessage({type:"ready"})},mainPage=function(){enterFlag=!0;var a=$("#main");a.addClass("center-img").html(loadingImg);setTimeout(function(){$("#loadImg").remove();
a.removeClass("center-img");var b=topPart(),b=b+chartPart(),b=b+settingPart(),b=b+tablePart(),b=b+bottom();a.html(b);renderChart();bindPoolAdd();bindPoolButton();bindSettingBtn();loopNano();updateSetting();chrome.runtime.sendMessage({type:"start"})},500);getRemoteData();getPrice();getPoolHashRate()},bottom=function(){return'<div class="login_panel" isLogin="">\n\t\t  <div class="panel_center">\n\t\t    <p class="tips">Canaan Creative</p>\n\t\t    <p class="connectBox1">\n\t\t\t<a title="EHash" href="https://ehash.com" target="_blank" rel="nofollow"><img alt="EHash" src="images/ehash.png"></a>\n\t\t\t<a title="Canaan Creative" href="http://www.canaan-creative.com" target="_blank" rel="nofollow"><img alt="Canaan Creative" src="images/home.png"></a>\n\t\t\t<a title="#Avalon" href="http://webchat.freenode.net/?randomnick=1&channels=avalon" target="_blank" rel="nofollow"><img alt="#avalon" src="images/irc.png"></a>\n\t\t\t<a title="service@canaan-creative.com" href="mailto:service@canaan-creative.com" target="_blank" rel="nofollow"><img alt="service@canaan-creative.com" src="images/email.png"></a>\n\n\t\t\t </p>\n\t\t  </div>\n\t\t</div>'},
loopNano=function(){for(var a=$jscomp.makeIterator(nanoObj),b=a.next();!b.done;b=a.next())deviceTr(b.value)},bindSettingBtn=function(){$("#setting-table").delegate("button","click",function(){settingDialog({title:"Setting"},paramObj);bindSettingSave()})},bindSettingSave=function(){$("#setting-save-div").delegate("button","click",function(){var a=parseInt($("#voltage-input").val()),b=parseInt($("#frequency1-input").val()),c=parseInt($("#frequency2-input").val()),d=parseInt($("#frequency3-input").val()),
a=window.isNaN(a)||8E3<a?6500:a,b=window.isNaN(b)||400<b?100:b,c=window.isNaN(c)||c>b?b:c,d=window.isNaN(d)||d>c?c:d;paramObj=a={freqSet:[b,c,d],voltSet:a};chrome.runtime.sendMessage({type:"setting",param:a});$("#dialogModel").modal("hide");updateSetting()})},bindPoolAdd=function(){$(".row-pool").delegate("button","click",function(){dialog({title:"Setting pool"},poolObj);bindSaveButton()})},bindSaveButton=function(a){$("#setting-pool").delegate("button","click",function(){for(var b=[],c=0;3>c;c++){var d=
_worker=_apikey="",d=$("#pool_address_"+c).val();_worker=$("#pool_worker_"+c).val();_apikey=$("#pool_apikey_"+c).val();if(d||_worker||_apikey){0<=d.indexOf("://")&&(d=d.split("://")[1]);var e=d.split(":"),d=e[0],e=parseInt(e[1]||3333);b.push({address:d,port:e,username:_worker,apiKey:_apikey})}}poolObj=b;chrome.runtime.sendMessage({type:"setting",pool:b});updatePoolList();$("#dialogModel").modal("hide");void 0!==a&&a()})},bindPoolButton=function(){$("td").delegate("button","click",function(){switch($(this).data("type")){case "edit":editPool($(this).data("id"));
break;case "remove":removePool($(this).data("id"))}})},removePool=function(a){chrome.runtime.sendMessage({info:"DeletePool",data:{poolId:a}});$("#pool-tr-id-"+a).remove();1===$("#pool_info tr").size()&&$("#pool_info").append('<tr id="pool-null"><td colspan="4" align="center" style="color:#cfcfcf;">Setting pool</td></tr>')},removeNano=function(a){$("#nano-tr-id-"+a).remove();for(var b=[],c=$jscomp.makeIterator(nanoObj),d=c.next();!d.done;d=c.next())d=d.value,d.nanoId!==a&&b.push(d);nanoObj=b;enterFlag||
detectDevice();1===$("#device tr").size()&&$("#device").append('<tr id="device-null"><td colspan="5" align="center" style="color:#cfcfcf;">Insert usb device</td></tr>')},maxPoolId=function(){return $("#pool_info tr:last-child").data("id")},topPart=function(){return'<div class="row top-div">\n\t\t<ul>\n\t\t\t<li><p>HUOBI (USD/CNY) : <span id="_huobi">0</span></p></li>\n\t\t\t<li><p>Difficulty : <span id="_difficulty">0</span></p></li>\n\t\t\t<li><p>Next : <span id="_next">0</span></p></li>\n\t\t\t<li><p>Hash Rate : <span id="_hash_rate">0</span></p></li>\n\t\t</ul>\n\t\t\x3c!--<p><button class="button button-small">BTC Price : <span id="Price">------<span></button></p>--\x3e\n        </div>\n\t'},
chartPart=function(){return'<div id="container" style="min-width:300px;height:300px"></div>'},panelPart=function(a,b,c){var d="device"===a?devicePart():"pool"===a?poolPart():"",e="device"===a?7:5;return tpl='<div class="col-xs-'+e+" col-md-"+e+" pull-"+b+'">\n\t\t<div class="panel panel-default">\n\t\t  <div class="panel-heading">\n\t\t    <h3 class="panel-title">'+c+'</h3>\n\t\t  </div>\n\t\t  <div class="panel-body" id="'+a+'_list">\n\t\t  '+d+"\n\t\t  </div>\n\t\t</div>\n\t</div>"},settingPart=
function(){return'\n\t\t<div class="row col-xs-12">\n\t\t\t<div class="panel panel-default">\n\t\t  \t\t<div class="panel-heading">\n\t\t    \t\t\t<h3 class="panel-title">Setting</h3>\n\t\t  \t\t</div>\n\t\t  \t\t<div class="panel-body" id="setting-table">\n\t\t\t\t\t<table class="table" style="margin-bottom:0px;">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Voltage</th>\n\t\t\t\t\t\t\t<th>Frequency1</th>\n\t\t\t\t\t\t\t<th>Frequency2</th>\n\t\t\t\t\t\t\t<th>Frequency3</th>\n\t\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td id="voltage" >12</td>\n\t\t\t\t\t\t\t<td id="frequency1">22</td>\n\t\t\t\t\t\t\t<td id="frequency2">22</td>\n\t\t\t\t\t\t\t<td id="frequency3">22</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<button type="button" class="btn btn-default">Setting </button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t  \t</div>\n\t\t</div>\n\t\t\t'},
updatePoolList=function(){_tpl=poolPart();$("#pool_list").html(_tpl);bindPoolAdd()},updatePoolStatus=function(a){_tpl="<p class='pool-status-"+a.info+"'>"+a.info+"</p>";$("#pool-status-"+a.poolId).html(_tpl)},updateDeviceStatus=function(a){void 0!==a.temperatureCu&&updateDeviceTemp(a.deviceId,a.temperatureCu,"cu");void 0!==a.temperatureFan&&updateDeviceTemp(a.deviceId,a.temperatureFan,"fan");void 0!==a.version&&updateDeviceVersion(a.deviceId,a.version)},updateDeviceVersion=function(a,b){$("#nano-version-"+
a).html(b)},updateErrorRate=function(a,b){$("#nano-error-rate-"+a).html(b)},updateDeviceGHs5s=function(a,b){$("#nano-ghs5s-"+a).html(b)},updateDeviceTemp=function(a,b,c){$("#"+c+"-temp-"+a).html(b)},devicePart=function(a){a='<table class="table table-hover" id="device"><tr><th>Device</th>';a+="<th>ID</th>";a+="<th>Version</th>";a+="<th>Temp(Cu/Fan)</th>";a+="<th>GHs5s</th>";a+="<th>Error%</th>";a+="</tr>";return a+="</table>"},poolPart=function(){var a;a='<table class="table table-hover" id="pool_info"><tr><th>Address</th>';
a+="<th>Worker</th>";a+="<th>Status</th>";a+="</tr>";if(poolObj.length)for(var b in poolObj)void 0!==poolObj[b]&&null!==poolObj[b]&&(a+=poolTr(b,poolObj[b]));else a+='<tr id="pool-null"><td colspan="3" align="center" style="color:#cfcfcf;">Setting pool</td></tr>';a+="</table>";return a+='<div class="row row-pool"><button type="button" class="btn btn-default pull-right pool-add">Setting Pool</button></div>'},poolTr=function(a,b){var c;c=""+('<tr data-id="'+a+'" id="pool-tr-id-'+a+'" class="pool-tr-line">')+
('<td id="pool-address-'+a+'">'+b.address+":"+b.port+"</td>");c+='<td id="pool-worker-'+a+'">'+b.username+"</td>";c+='<td id="pool-status-'+a+'">---</td>';c+='<input type="hidden" id="pool-api-key-'+a+'" value="'+b.apiKey+'"/>';return c+="</tr>"},deviceTr=function(a){void 0!==$("#device-null").html()&&$("#device-null").remove();var b=a.nanoId;a=a.deviceType;a=""+('<tr class="active" id="nano-tr-id-'+b+'">')+("<td>"+a+"</td>");a+='<td id="nano-device-id-'+b+'">'+b+"</td>";a+='<td id="nano-version-'+
b+'">---</td>';a+='<td id="nano-temp-'+b+'"><span id="cu-temp-'+b+'">0</span> / <span id="fan-temp-'+b+'">0</span></td>';a+='<td id="nano-ghs5s-'+b+'">0</td>';a+='<td id="nano-error-rate-'+b+'">0</td>';a+="</tr>";$("#device").append(a)},tablePart=function(){var a;a='<div class="row" style="margin-bottom:50px;">'+panelPart("device","left","Device List");a+=panelPart("pool","right","Pool List");return a+"</div>"},settingPool=function(){dialog({title:"Setting pool"});bindSaveButton(mainPage)},updateNanoData=
function(a,b,c){switch(b){case "status":!0!==c?($("#nano-tr-id-"+a).removeClass("active").addClass("warning"),$("#nano-status-"+a).html("Connect failt")):$("#nano-status-"+a).html("Connect success");break;case "frequency":$("#nano-frequency-"+a).html(c)}},dialog=function(a,b){0<$("#dialogModel").length&&($("#dialogModel").remove(),$(".modal-backdrop").remove());var c,d,e;c=a&&a.title?a.title:"Message";d=a&&a.fade?"fade":"";e='<div><div class="form-group"><table class="table">';e+="<tr><th>Pool</th><th>Url</th><th>Worker</th><th>apiKey</th></tr>";
for(var f=0;3>f;f++){var g=_worker=_apiKey=_port="";void 0!==b&&void 0!==b[f]&&(g=b[f].address||"",_worker=b[f].username||"",_apiKey=b[f].apiKey||"",_port=b[f].port||"",g=g+":"+_port);e+="<tr>";e+='<td><label for="">#'+(f+1)+"</label></td>";e+='<td><input type="text" class="form-control" value="'+g+'" id="pool_address_'+f+'" placeholder="Pool url"></td>';e+='<td><input type="text" class="form-control" value="'+_worker+'" id="pool_worker_'+f+'" placeholder="Pool worker"></td>\t';e+='<td><input type="text" class="form-control" value="'+
_apiKey+'" id="pool_apikey_'+f+'" placeholder="apiKey"></td>';e+="</tr>"}e+='<tr><td colspan="4">';e+='<div class="form-group" id="setting-pool">';e+='<button typ="button" class="btn btn-default pull-right" id="add-pool-save">Save Setting</button>';e+='<span id="message"></span>';e+="</div></td></tr></table></div></div>";d='<div class="modal '+d+'" id="dialogModel"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>';
d+='<h4 class="modal-title"><strong>'+c+"</strong></h4></div>";d+='<div class="modal-body">'+e+"</div>";d+='<div class="modal-footer"></div>';d+="</div></div></div>";$("body").append(d);$("#dialogModel").modal({backdrop:"static",keyboard:!1})},updateSetting=function(){var a=paramObj,b=a.voltSet,c=a.freqSet[0],d=a.freqSet[1],a=a.freqSet[2];$("#voltage").html(b);$("#frequency1").html(c);$("#frequency2").html(d);$("#frequency3").html(a)},settingDialog=function(a,b){0<$("#dialogModel").length&&($("#dialogModel").remove(),
$(".modal-backdrop").remove());var c,d,e;c=a&&a.title?a.title:"Message";d=a&&a.fade?"fade":"";e='\n\t\t<div style="margin-bottom:50px;">\n\t\t\t<div class="form-group">\n\t\t\t<label for="Voltage">Voltage</label>\n\t\t\t\t<input type="text" class="form-control" id="voltage-input" value="'+b.voltSet+'"placeholder="Voltage">\n\t\t\t</div>\n\t\t\t<div class="form-group">\n\t\t\t<label for="Frequency1">Frequency#1</label>\n\t\t\t\t<input type="text" class="form-control" id="frequency1-input" value="'+
b.freqSet[0]+'" placeholder="Frequency1">\n\t\t\t</div>\n\t\t\t<div class="form-group">\n\t\t\t<label for="Frequency2">Frequency#2</label>\n\t\t\t\t<input type="text" class="form-control" id="frequency2-input" value="'+b.freqSet[1]+'" placeholder="Frequency2">\n\t\t\t</div>\n\t\t\t<div class="form-group">\n\t\t\t<label for="Frequency3">Frequency#3</label>\n\t\t\t\t<input type="text" class="form-control" id="frequency3-input" value="'+b.freqSet[2]+'" placeholder="Frequency3">\n\t\t\t</div>\n\t\t\t<div class="form-group" id="setting-save-div">\n\t\t\t<button type="button" class="btn btn-default pull-right">Save setting</button>\n\t\t\t</div>\n\t\t</div>\n\t';
d='<div class="modal '+d+'" id="dialogModel"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>';d+='<h4 class="modal-title"><strong>'+c+"</strong></h4></div>";d+='<div class="modal-body">'+e+"</div>";d+='<div class="modal-footer"></div>';d+="</div></div></div>";$("body").append(d);$("#dialogModel").modal({backdrop:"static",keyboard:!1})};
$(function(){guidePage(guideCallback);chrome.runtime.onMessage.addListener(function(a,b){if(-1<b.url.indexOf("background"))switch(a.type){case "setting":globalSetting(a.param);poolList(a.pool);break;case "device":nanoList({nanoId:a.deviceId,deviceType:a.deviceType});break;case "delete":removeNano(a.deviceId);break;case "pool":updatePoolStatus(a);break;case "status":updateDeviceStatus(a);break;case "hashrate":updateHashrate(a.hashrate)}})});
