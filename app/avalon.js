var $jscomp={scope:{},global:this,initSymbolIterator:function(){Symbol=$jscomp.global.Symbol||{};Symbol.iterator||(Symbol.iterator="$jscomp$iterator");$jscomp.initSymbolIterator=function(){}},makeIterator:function(a){$jscomp.initSymbolIterator();if(a[Symbol.iterator])return a[Symbol.iterator]();if(!(a instanceof Array)&&"string"!=typeof a)throw Error();var b=0;return{next:function(){return b==a.length?{done:!0}:{done:!1,value:a[b++]}}}},copyProperties:function(a,b){for(var c in b)a[c]=b[c]},inherits:function(a,
b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}},AVALON_VENDOR_ID=10737,AVALON_PRODUCT_ID_NANO=13299,AVALON_PRODUCT_ID_MINI=16625,FILTERS={filters:[{vendorId:AVALON_VENDOR_ID,productId:AVALON_PRODUCT_ID_NANO},{vendorId:AVALON_VENDOR_ID,productId:AVALON_PRODUCT_ID_MINI}]},P_DETECT=16,P_SET_VOLT=34,P_SET_FREQ=35,P_WORK=36,P_POLLING=48,P_REQUIRE=49,P_TEST=50,P_ACKDETECT=64,P_STATUS=65,P_NONCE=66,P_TEST_RET=67,CANAAN_HEAD1=67,CANAAN_HEAD2=78,CRC16_TABLE=[0,4129,8258,
12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,
52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,
17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920],SHA256_TABLE=[1116352408,
1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,
430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],SHA256_INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],NANO_LOG_LIMIT=1,POOL_LOG_LIMIT=1,NANO_LOG1_STYLE="color: green",NANO_LOG2_STYLE="color: blue",NANO_DEBUG_STYLE="color: black",POOL_LOG1_STYLE="color: orange",POOL_LOG2_STYLE="color: orangered",POOL_DEBUG_STYLE="color: grey",MINER_LOG1_STYLE=
"color: pink",MINER_LOG2_STYLE="color: magenta",MINER_DEBUG_STYLE="color: silver",check_version=function(a){return"3U1504"===a.slice(0,6)||"4M1505"===a.slice(0,6)},crc16=function(a){a=new Uint8Array(a);for(var b=0,c=0,d=a.byteLength;0<d--;)b=CRC16_TABLE[(b>>>8^a[c++])&255]^b<<8;return b},ab2hex=function(a){var b=new Uint8Array(a);a="";for(var b=$jscomp.makeIterator(b),c=b.next();!c.done;c=b.next())a+=("0"+c.value.toString(16)).slice(-2);return a},hex2ab=function(a){for(var b=a.length/2,c=new ArrayBuffer(b),
d=new Uint8Array(c),e=0;e<b;e++)d[e]=parseInt(a.slice(2*e,2*e+2),16);return c},ab2str=function(a){return String.fromCharCode.apply(null,new Uint8Array(a))},str2ab=function(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c},mm_encode=function(a,b,c,d,e){var f=new ArrayBuffer(40),g=new Uint8Array(f);e=new Uint8Array(e);g[0]=CANAAN_HEAD1;g[1]=CANAAN_HEAD2;g[2]=a;g[3]=b;g[4]=c;g[5]=d;for(a=0;32>a;a++)g[a+6]=e[a]||0;a=crc16(f.slice(6,38));g[38]=(a&
65280)>>>8;g[39]=a&255;return f},mm_decode=function(a){var b=new Uint8Array(a),c=b[1];if(b[0]!==CANAAN_HEAD1||c!==CANAAN_HEAD2)return console.warn("Wrong head."),!1;c=b[2];a=a.slice(6,38);var d=b[38],b=b[39],e=crc16(a);if(d!==(e&65280)>>>8||b!==(e&255))return console.warn("Wrong CRC."),!1;switch(c){case P_ACKDETECT:b=ab2hex(a.slice(0,8));c="";d=$jscomp.makeIterator(new Uint8Array(a.slice(8,23)));for(e=d.next();!e.done;e=d.next())c+=String.fromCharCode(e.value);a=(new DataView(a.slice(23,27))).getUint32(0);
return{type:P_ACKDETECT,version:c,dna:b,asicCount:a};case P_NONCE:b=new DataView(a);a={type:P_NONCE,value:[]};for(c=0;2>c;c++)if(255!==b.getUint8(16*c+6,!1)){var d=b.getUint8(16*c+0),e=b.getUint8(16*c+1,!1),f=b.getUint32(16*c+2,!1),g=b.getUint8(16*c+7,!1),h=b.getUint32(16*c+8,!1)-16384;a.value.push({type:P_NONCE,nonce:h,nonce2:f,jobId:e,poolId:d,ntime:g})}return a;case P_STATUS:return b=new DataView(a),(new DataView(a)).getUint32(0,!1),{type:P_STATUS,spiSpeed:b.getUint32(0,!1),led:b.getUint32(4,!1),
voltage:voltageDecode(b.getUint32(12,!1)),powerGood:b.getUint32(28,!1)}}},gw_pool2raw=function(a,b,c,d,e){var f=new ArrayBuffer(64),g=new DataView(f),h;b=b.slice(128,152);for(h=0;32>h;h++)g.setUint8(31-h,parseInt(a.slice(2*h,2*h+2),16));g.setUint8(32,c);g.setUint8(33,d);g.setUint32(34,e,!1);for(h=0;12>h;h++)g.setUint8(63-h,parseInt(b.slice(2*h,2*h+2),16));return f},sha256=function(a){return(new jsSHA(a,"HEX")).getHash("SHA-256","HEX")},get_blockheader=function(a,b){b=uInt2LeHex(b,a.nonce2_size);for(var c=
sha256(sha256(a.coinbase1+a.nonce1+b+a.coinbase2)),d=$jscomp.makeIterator(a.merkle_branch),e=d.next();!e.done;e=d.next())c=sha256(sha256(c+e.value));d=new ArrayBuffer(76);e=new DataView(d);e.setUint32(0,parseInt(a.version,16),!1);for(var f=0;8>f;f++)e.setUint32(4*(f+1),parseInt(a.prevhash.slice(8*f,8*f+8),16),!1),e.setUint32(4*(f+9),parseInt(c.slice(8*f,8*f+8),16),!0);e.setUint32(68,parseInt(a.ntime,16),!1);e.setUint32(72,parseInt(a.nbits,16),!1);return ab2hex(d)},varifyWork=function(a,b,c,d){b=uInt2LeHex(b,
a.nonce2_size);b=sha256(sha256(a.coinbase1+a.nonce1+b+a.coinbase2));for(var e=$jscomp.makeIterator(a.merkle_branch),f=e.next();!f.done;f=e.next())b=sha256(sha256(b+f.value));e=new ArrayBuffer(80);f=new DataView(e);f.setUint32(0,parseInt(a.version,16),!0);for(var g=0;8>g;g++)f.setUint32(4*(g+1),parseInt(a.prevhash.slice(8*g,8*g+8),16),!0),f.setUint32(4*(g+9),parseInt(b.slice(8*g,8*g+8),16),!1);f.setUint32(68,c,!0);f.setUint32(72,parseInt(a.nbits,16),!0);f.setUint32(76,d,!1);c=sha256(sha256(ab2hex(e)));
if("00000000"!==c.slice(56,64))return 2;a=new Uint8Array(a.target);c=new Uint8Array(hex2ab(c));for(d=0;32>d;d++){if(c[31-d]>a[d])return 1;if(c[31-d]<a[d])break}return 0},get_midstate=function(a){var b=new DataView(hex2ab(a.slice(0,128))),c=[];a=[];var d,e,f,g;for(d=0;16>d;d++)c[d]=b.getUint32(4*d,!0);for(d=0;8>d;d++)a[d]=SHA256_INIT[d];d=$jscomp.makeIterator(SHA256_TABLE);for(b=d.next();!b.done;b=d.next()){var h=b.value,b=_rotateright(a[0],2)^_rotateright(a[0],13)^_rotateright(a[0],22);e=_rotateright(a[4],
6)^_rotateright(a[4],11)^_rotateright(a[4],25);f=a[0]&a[1]^a[0]&a[2]^a[1]&a[2];g=a[4]&a[5]^~a[4]&a[6];a[7]=_addu32(a[7],c[0],h,g,e);a[3]=_addu32(a[3],a[7]);a[7]=_addu32(a[7],f,b);a.unshift(a[7]);a.pop();b=_rotateright(c[1],7)^_rotateright(c[1],18)^c[1]>>>3;e=_rotateright(c[14],17)^_rotateright(c[14],19)^c[14]>>>10;c.push(_addu32(c[0],b,c[9],e));c.shift()}c=new ArrayBuffer(32);b=new DataView(c);for(d=0;8>d;d++)b.setUint32(4*d,_addu32(a[d],SHA256_INIT[d]),!0);return ab2hex(c)},_rotateright=function(a,
b){b&=31;return a>>>b|a<<32-b&4294967295},_addu32=function(){for(var a=0,b=$jscomp.makeIterator(arguments),c=b.next();!c.done;c=b.next())a=a+c.value&4294967295;return a&4294967295},padLeft=function(a,b){for(b=2*(b||4);a.length<b;)a="0"+a;return a},uInt2LeHex=function(a,b){var c=new ArrayBuffer(4);(new DataView(c)).setUint32(0,a,!0);return ab2hex(c).slice(0,2*b)},arraySum=function(a){return a.reduce(function(a,c){return a+c})},getTarget=function(a){for(var b=new ArrayBuffer(32),c=new DataView(b),d=
65535,e=2;16>e;e++)c.setUint16(2*e,Math.floor(d/a)),d=d%a<<16;return b},voltageDecode=function(a){return 255===a?0:125*(89-(a>>>1))+5E3},voltageEncode=function(a){if(0===a)return hex2ab("00ff");var b=new ArrayBuffer(2);(new DataView(b)).setUint16(0,(89-(a-5E3)/125&255)<<1|1,!1);return b},Nano=function(a,b){this.device=a;switch(a.productId){case AVALON_PRODUCT_ID_NANO:this.deviceType="Avalon nano";break;case AVALON_PRODUCT_ID_MINI:this.deviceType="Avalon4 mini"}this.miner=b;this._enable=!1;this.voltage=
this.frequency=null;this.powerGood=0};Nano.prototype.__defineGetter__("id",function(){return this.device.deviceId});Nano.prototype.connect=function(){var a=this;chrome.hid.connect(this.id,function(b){chrome.runtime.lastError?(a.log("error",chrome.runtime.lastError.message),a.miner.nanoConnected={nanoId:a.id,success:!1}):(a.connection=b,a.miner.nanoConnected={nanoId:a.id,success:!0},a._receive())})};
Nano.prototype.disconnect=function(){var a=this;chrome.hid.disconnect(a.connection.connectionId,function(){a.log("info","Disconnected.")})};
Nano.prototype.run=function(){this._enable=!0;var a=this.asicCount||1,b=this,c=mm_encode(P_POLLING,0,1,1,new ArrayBuffer(32)),d=mm_encode(P_SET_VOLT,0,1,1,voltageEncode(6250)),e=0,f,g=function(){for(f=f||b.miner.getWork;void 0!==f;){if(0===b.powerGood){b._send(d);b._send(c);b._receive();setTimeout(g,1E3);return}for(var h=0;h<f.length;h++)b._send(f[h],h);f=b.miner.getWork;if(++e===a)break}if(e<a)setTimeout(g,20);else if(e===a&&b._enable){for(h=e=0;h<a;h++)b._send(c),b._receive();setTimeout(g,175)}};
g()};Nano.prototype.stop=function(){this._enable=!1;this.log("info","Stopped.")};Nano.prototype.detect=function(){this._send(mm_encode(P_DETECT,0,1,1,new ArrayBuffer(32)));this._receive()};Nano.prototype._send=function(a,b){var c=this;chrome.hid.send(this.connection.connectionId,0,a,function(){chrome.runtime.lastError?c.log("error",chrome.runtime.lastError.message):c.log("debug","Sent:     0x%s",ab2hex(a))})};
Nano.prototype._receive=function(){var a=this;chrome.hid.receive(this.connection.connectionId,function(b,c){chrome.runtime.lastError?a.log("error",chrome.runtime.lastError.message):(a.log("debug","Received: 0x%s",ab2hex(c)),a.received=c)})};
Nano.prototype.__defineSetter__("received",function(a){a=mm_decode(a);switch(a.type){case P_NONCE:a=$jscomp.makeIterator(a.value);for(var b=a.next();!b.done;b=a.next())b=b.value,this.log("log2","Nonce:    0x%s",b.nonce.toString(16)),this.miner.newNonce={nanoId:this.id,nonce:b.nonce,nonce2:b.nonce2,jobId:b.jobId,poolId:b.poolId,ntime:b.ntime};break;case P_STATUS:this.log("log2","Status:   0x%s, 0x%s, %d, %d",a.spiSpeed.toString(16),a.led.toString(16),a.voltage,a.powerGood);this.powerGood!==a.powerGood&&
(this.powerGood=a.powerGood);this.voltage!==a.voltage&&(this.voltage=a.voltage,this.miner.newStatus={nanoId:this.id,stat:{voltage:a.voltage}});break;case P_ACKDETECT:this.log("log1","Version:  %s",a.version),this.log("log1","DNA:      %s",a.dna),this.log("log1","AsicCount:%s",a.asicCount),this.version=a.version,this.dna=a.dna,this.asicCount=a.asicCount,check_version(this.version)?this.miner.nanoDetected={nanoId:this.id,version:this.version,success:!0}:(this.log("info","Wrong Version."),this.miner.nanoDetected=
{nanoId:this.id,version:this.version,success:!1})}});Nano.prototype.__defineSetter__("sent",function(a){if(this._enable){var b=this;(function d(){var a=b.miner.getWork;if(void 0!==a){b._send(mm_encode(P_POLLING,0,1,1,new ArrayBuffer(32)));b._receive();for(var f=0;f<a.length;f++)b._send(a[f],f)}else setTimeout(d,100)})()}});
Nano.prototype.log=function(a){var b=Array.prototype.slice.call(arguments);switch(a){case "error":if(4<NANO_LOG_LIMIT)break;b[0]="[NANO %d] "+arguments[1];b[1]=this.id;console.error.apply(console,b);break;case "warn":if(3<NANO_LOG_LIMIT)break;b[0]="[NANO %d] "+arguments[1];b[1]=this.id;console.warn.apply(console,b);break;case "info":if(2<NANO_LOG_LIMIT)break;b[0]="[NANO %d] "+arguments[1];b[1]=this.id;console.info.apply(console,b);break;case "log1":if(1<NANO_LOG_LIMIT)break;b.unshift("%c[NANO %d] "+
arguments[1]);b[1]=NANO_LOG1_STYLE;b[2]=this.id;console.log.apply(console,b);break;case "log2":if(0<NANO_LOG_LIMIT)break;b.unshift("%c[NANO %d] "+arguments[1]);b[1]=NANO_LOG2_STYLE;b[2]=this.id;console.log.apply(console,b);break;case "debug":if(0<NANO_LOG_LIMIT)break;b.unshift("%c[NANO %d] "+arguments[1]);b[1]=NANO_DEBUG_STYLE;b[2]=this.id;console.debug.apply(console,b)}};
Pool=function(a){this.id=a.id;this.url=a.url;this.port=a.port;this.username=a.username;this.password=a.password;this.difficulty=1;this.miner=miner;this.submitQueue=[];this.submitId=0;this._SUBSCRIBE={id:1,method:"mining.subscribe",params:["avalon-miner-chrome"]};this._AUTHORIZE={id:2,method:"mining.authorize",params:[this.username,this.password]}};
Pool.prototype.run=function(){var a=this;chrome.sockets.tcp.create({},function(b){a.socketId=b.socketId;chrome.sockets.tcp.connect(a.socketId,a.url,a.port,function(b){chrome.runtime.lastError?a.log("error",chrome.runtime.lastError.message):(a.log("info","Connected."),a.upload(a._SUBSCRIBE))})})};Pool.prototype.disconnect=function(){var a=this;void 0!==this.socketId&&chrome.sockets.tcp.disconnect(this.socketId,function(){chrome.sockets.tcp.close(a.socketId,function(){a.log("info","Disconnected.")})})};
Pool.prototype.decode=function(a){a=JSON.parse(a);switch(a.method){case "mining.set_difficulty":this.difficulty=a.params[a.params.length-1];break;case "mining.notify":this.miner.newJob={poolId:this.id,nonce1:this.nonce1,nonce2_size:this.nonce2_size,job_id:a.params[0],prevhash:a.params[1],coinbase1:a.params[2],coinbase2:a.params[3],merkle_branch:a.params[4],version:a.params[5],nbits:a.params[6],ntime:a.params[7],clean_jobs:a.params[8],target:getTarget(this.difficulty)};break;case "mining.ping":this.upload({id:a.id,
result:"pong",error:null});break;case "client.reconnect":this.disconnect();this.run();break;default:if(1===a.id){if(a.error)return this.miner.poolSubscribed={poolId:this.id,success:!1},this.log("warn","Subscription Failed."),!1;this.miner.poolSubscribed={poolId:this.id,success:!0};this.log("log1","Subscribed.");this.nonce1=a.result[a.result.length-2];this.nonce2_size=a.result[a.result.length-1];"mining.set_difficulty"===a.result[0][0][0]&&(this.difficulty=a.result[0][0][1]);this.upload(this._AUTHORIZE)}else if(2===
a.id){if(a.error)return this.miner.poolAuthorized={poolId:this.id,success:!1},this.log("warn","Authorization Failed."),!1;this.miner.poolAuthorized={poolId:this.id,success:!0};this.log("log1","Authorized.")}else if(1E3<=a.id){if(a.error)return this.log("warn","Submission Failed."),!1;if(!a.result)return this.log("log2","Submission Failed: %s.",a["reject-reason"]),!1;this.log("log1","Submitted.")}}};
Pool.prototype.submit=function(a,b,c,d){a={params:[this.username,a,b,c,d],id:1E3+this.submitId,method:"mining.submit"};this.submitId=(this.submitId+1)%1E3;this.submitQueue[this.submitId]={data:a,retry:0};this.upload(a)};
Pool.prototype.upload=function(a){var b=this,c=JSON.stringify(a);this.log("debug","Sent:     %s",c);c=str2ab(c+"\n");chrome.sockets.tcp.send(this.socketId,c,function(c){if(chrome.runtime.lastError){if(b.log("error",chrome.runtime.lastError.message),"mining.submit"===a.method){var e=a.id-1E3;3>++b.submitQueue[e].retry?setTimeout(function(){b.upload(b.submitQueue[e].data)},1E3):delete b.submitQueue[e]}}else"mining.submit"===a.method&&delete b.submitQueue[a.id-1E3]})};
Pool.prototype.download=function(a){a=ab2str(a.data).split("\n");for(var b=0;b<a.length-1;b++)this.log("debug","Received: %s",a[b]),this.decode(a[b])};
Pool.prototype.log=function(a){var b=Array.prototype.slice.call(arguments);switch(a){case "error":if(4<POOL_LOG_LIMIT)break;b[0]="[POOL %d] "+arguments[1];b[1]=this.id;console.error.apply(console,b);break;case "warn":if(3<POOL_LOG_LIMIT)break;b[0]="[POOL %d] "+arguments[1];b[1]=this.id;console.warn.apply(console,b);break;case "info":if(2<POOL_LOG_LIMIT)break;b[0]="[POOL %d] "+arguments[1];b[1]=this.id;console.info.apply(console,b);break;case "log1":if(1<POOL_LOG_LIMIT)break;b.unshift("%c[POOL %d] "+
arguments[1]);b[1]=POOL_LOG1_STYLE;b[2]=this.id;console.log.apply(console,b);break;case "log2":if(1<POOL_LOG_LIMIT)break;b.unshift("%c[POOL %d] "+arguments[1]);b[1]=POOL_LOG2_STYLE;b[2]=this.id;console.log.apply(console,b);break;case "debug":if(0<POOL_LOG_LIMIT)break;b.unshift("%c[POOL %d] "+arguments[1]);b[1]=POOL_DEBUG_STYLE;b[2]=this.id;console.debug.apply(console,b)}};
var Miner=function(){this.onNewNano=new MinerEvent;this.onNanoDeleted=new MinerEvent;this.onNanoConnected=new MinerEvent;this.onNanoDetected=new MinerEvent;this.onNewStatus=new MinerEvent;this.onPoolSubscribed=new MinerEvent;this.onPoolAuthorized=new MinerEvent;this.onHashrate=new MinerEvent;this._JOB_BUFFER_SIZE=256;this._WORK_BUFFER_SIZE=1024;this._jobId=[];this._poolId=0;this._jobs=[];this._works=[];this._nanos=[];this._pools=[];this._hashrates=[];this._total_hashrate=Array.apply(null,Array(3601)).map(Number.prototype.valueOf,
0);var a=this;this.scanNano();chrome.hid.onDeviceAdded.addListener(function(b){a.newNano={nano:new Nano(b,a),nanoId:b.deviceId}});chrome.hid.onDeviceRemoved.addListener(function(b){a.nanoDeleted=b});chrome.sockets.tcp.onReceive.addListener(function(b){for(var c=$jscomp.makeIterator(a._pools),d=c.next();!d.done;d=c.next())if(d=d.value,void 0!==d&&b.socketId===d.socketId){d.download(b);break}});chrome.sockets.tcp.onReceiveError.addListener(function(b){console.info("Connection "+b.socketId+" Failed.");
for(var c=$jscomp.makeIterator(a._pools),d=c.next();!d.done;d=c.next())if(d=d.value,void 0!==d&&b.socketId===d.socketId){d.run();break}});this._thread=[];this._thread_pause=[];this._stop=!1;(function c(){var d=[],e,f;for(f in a._hashrates)e=a._hashrates[f],void 0!==e&&(e.unshift(0),d.push({nanoId:f,hs1h:arraySum(e.slice(1))/3600*4294967296,hs15m:arraySum(e.slice(1,901))/900*4294967296,hs5m:arraySum(e.slice(1,301))/300*4294967296,hs1m:arraySum(e.slice(1,61))/60*4294967296,hs15s:arraySum(e.slice(1,
16))/15*4294967296,hs5s:arraySum(e.slice(1,6))/5*4294967296,hs1s:4294.967296*e[1]}),e.pop());e=a._total_hashrate;e.unshift(0);d.push({nanoId:null,hs1h:arraySum(e.slice(1))/3600*4294967296,hs15m:arraySum(e.slice(1,901))/900*4294967296,hs5m:arraySum(e.slice(1,301))/300*4294967296,hs1m:arraySum(e.slice(1,61))/60*4294967296,hs15s:arraySum(e.slice(1,16))/15*4294967296,hs5s:arraySum(e.slice(1,6))/5*4294967296,hs1s:4294.967296*e[1]});e.pop();a.hashrate=d;a._stop||setTimeout(c,2500)})()};
Miner.prototype.__defineSetter__("newJob",function(a){var b=a.poolId;this._jobId[b]=(this._jobId[b]+1)%this._JOB_BUFFER_SIZE;this._jobs[b][this._jobId]=a;this._works[b]=[];this._thread_pause[b]=!1;this._thread[b].postMessage({job:a,jobId:this._jobId[b],poolId:b})});
Miner.prototype.__defineSetter__("newNano",function(a){this.log("info","New Nano: %d",a.nanoId);this._nanos[a.nanoId]=a.nano;this._hashrates[a.nanoId]=this._hashrates[a.nanoId]||Array.apply(null,Array(3601)).map(Number.prototype.valueOf,0);a.nano.connect();this.onNewNano.fire(a)});Miner.prototype.__defineSetter__("nanoDeleted",function(a){this.log("info","Nano Deleted: %d",a);this._nanos[a].stop();delete this._nanos[a];delete this._hashrates[a];this.onNanoDeleted.fire(a)});
Miner.prototype.__defineSetter__("nanoConnected",function(a){a.success&&this._nanos[a.nanoId].detect();this.onNanoConnected.fire(a)});Miner.prototype.__defineSetter__("nanoDetected",function(a){a.success&&this._nanos[a.nanoId].run(4);this.onNanoDetected.fire(a)});Miner.prototype.__defineSetter__("poolSubscribed",function(a){this.onPoolSubscribed.fire(a)});Miner.prototype.__defineSetter__("poolAuthorized",function(a){this.onPoolAuthorized.fire(a)});
Miner.prototype.__defineSetter__("newNonce",function(a){if(void 0!==this._jobs[a.poolId]){var b=this._jobs[a.poolId][a.jobId];if(void 0!==b){var c=a.ntime+parseInt(b.ntime,16);switch(varifyWork(b,a.nonce2,c,a.nonce)){case 0:this._pools[a.poolId].submit(b.job_id,uInt2LeHex(a.nonce2,b.nonce2_size),c.toString(16),uInt2LeHex(a.nonce,4));case 1:this._hashrates[a.nanoId][0]++,this._total_hashrate[0]++}}}});Miner.prototype.__defineSetter__("newStatus",function(a){this.onNewStatus.fire(a)});
Miner.prototype.__defineSetter__("hashrate",function(a){this.onHashrate.fire(a)});Miner.prototype.__defineGetter__("getWork",function(){if(void 0!==this._active_pool){var a=this._works[this._active_pool].shift();this._thread_pause[this._active_pool]&&this._works[this._active_pool].length<this._WORK_BUFFER_SIZE-10&&(this._thread[this._active_pool].postMessage("resume"),this._thread_pause[this._active_pool]=!1);return a}});
Miner.prototype.setPool=function(a,b){var c=this;void 0!==this._pools[b]&&this._pools[b].disconnect();a.id=b;this._jobId[b]=-1;this._jobs[b]=[];this._works[b]=[];this._pools[b]=new Pool(a,this);this._thread[b]=new Worker("thread.js");this._thread[b].onmessage=function(a){c._works[b].push(a.data);c._works[b].length>=c._WORK_BUFFER_SIZE&&(c._thread[b].postMessage("pause"),c._thread_pause[b]=!0)};this._pools[b].run();this._active_pool=this._active_pool||b};
Miner.prototype.deletePool=function(a){this._pools[a].disconnect();delete this._works[a];delete this._thread[a];delete this._thread_pause[a];delete this._jobId[a];delete this._pools[a]};Miner.prototype.scanNano=function(){var a=this;chrome.hid.getDevices(FILTERS,function(b){if(chrome.runtime.lastError)console.error(chrome.runtime.lastError.message);else{b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next())c=c.value,a.newNano={nano:new Nano(c,a),nanoId:c.deviceId}}})};
Miner.prototype.stop=function(){this._stop=!0;for(var a=$jscomp.makeIterator(this._nanos),b=a.next();!b.done;b=a.next())b=b.value,void 0!==b&&(b.stop(),b.disconnect());a=$jscomp.makeIterator(this._pools);for(b=a.next();!b.done;b=a.next())b=b.value,void 0!==b&&b.disconnect()};
Miner.prototype.log=function(a){var b=Array.prototype.slice.call(arguments);b.shift();switch(a){case "error":b[0]="[MINER] "+arguments[1];console.error.apply(console,b);break;case "warn":b[0]="[MINER] "+arguments[1];console.warn.apply(console,b);break;case "info":b[0]="[MINER] "+arguments[1];console.info.apply(console,b);break;case "log1":b.unshift("%c[MINER] "+arguments[1]);b[1]=MINER_LOG1_STYLE;console.log.apply(console,b);break;case "log2":b.unshift("%c[MINER] "+arguments[1]);b[1]=MINER_LOG2_STYLE;
console.log.apply(console,b);break;case "debug":b.unshift("%c[MINER] "+arguments[1]),b[1]=MINER_DEBUG_STYLE,console.debug.apply(console,b)}};var MinerEvent=function(){this._registered=[]};MinerEvent.prototype.addListener=function(a){return this._registered.push(a)-1};MinerEvent.prototype.removeListener=function(a){delete this._registered[a]};MinerEvent.prototype.fire=function(a){for(var b=$jscomp.makeIterator(this._registered),c=b.next();!c.done;c=b.next())c=c.value,void 0!==c&&c(a)};
